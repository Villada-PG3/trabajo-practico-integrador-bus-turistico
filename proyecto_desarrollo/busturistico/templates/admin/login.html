{% extends "admin/base.html" %}
{% load i18n static %}

{% block title %}{% trans "Iniciar sesión" %} | Bus Turístico{% endblock %}

{% block content %}
<div class="admin-login-wrapper">
  <div class="admin-login-card">
    <div class="admin-login-header">
      <div class="admin-login-logo" aria-hidden="true">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="2" y="5" width="20" height="12" rx="2" fill="#0ea5e9"/>
          <circle cx="7" cy="18" r="2" fill="#0ea5e9" stroke="#0f172a"/>
          <circle cx="17" cy="18" r="2" fill="#0ea5e9" stroke="#0f172a"/>
          <rect x="4" y="7" width="6" height="4" rx="1" fill="#e2f5fd"/>
          <rect x="12" y="7" width="8" height="4" rx="1" fill="#e2f5fd"/>
        </svg>
      </div>
      <div>
        <h1 class="admin-login-title">Acceso al Panel</h1>
        <p class="admin-login-subtitle">Usá tu usuario y contraseña institucional.</p>
      </div>
    </div>

    {% if form.errors %}
      <div class="admin-login-errors">
        <p>Usuario o contraseña inválidos. Intentá nuevamente.</p>
      </div>
    {% endif %}

    <form action="{{ app_path }}" method="post" id="login-form" novalidate>
      {% csrf_token %}
      <input type="hidden" name="this_is_the_login_form" value="1">
      {% url 'admin-dashboard' as dashboard_url %}
      {% url 'admin:index' as admin_index_url %}
      <input type="hidden" name="next" value="{% if next %}{% if next == admin_index_url %}{{ dashboard_url }}{% else %}{{ next }}{% endif %}{% else %}{{ dashboard_url }}{% endif %}">

      <div class="form-field">
        <label for="id_username">Usuario</label>
        <div class="input-with-icon">
          <span class="input-icon" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 12c2.761 0 5-2.239 5-5s-2.239-5-5-5-5 2.239-5 5 2.239 5 5 5z" fill="#64748b"/>
              <path d="M4 22c0-4.418 3.582-8 8-8s8 3.582 8 8" stroke="#94a3b8" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          <input
            type="text"
            name="username"
            autofocus
            autocapitalize="none"
            autocomplete="username"
            maxlength="150"
            required
            id="id_username"
            placeholder="tu.usuario"
            value="{{ form.username.value|default:'' }}"
          >
        </div>
      </div>

      <div class="form-field">
        <label for="id_password">Contraseña</label>
        <div class="input-with-icon">
          <span class="input-icon" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="10" width="18" height="10" rx="2" fill="#94a3b8"/>
              <rect x="7" y="6" width="10" height="6" rx="3" fill="#cbd5e1"/>
            </svg>
          </span>
          <input
            type="password"
            name="password"
            autocomplete="current-password"
            required
            id="id_password"
            placeholder="••••••••"
          >
          <button type="button" class="toggle-password" aria-label="Mostrar contraseña">
            <svg class="eye" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2 12s4-6 10-6 10 6 10 6-4 6-10 6-10-6-10-6z" stroke="#64748b" stroke-width="2"/>
              <circle cx="12" cy="12" r="3" fill="#64748b"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="actions">
        <button type="submit" class="button default large" id="login-submit">
          <span class="btn-icon" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 12h10" stroke="#ffffff" stroke-width="2" stroke-linecap="round"/>
              <path d="M11 7l5 5-5 5" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          Ingresar
        </button>
        <a href="/" class="button outline large" id="back-home">
          <span class="btn-icon" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 12H9" stroke="#0369a1" stroke-width="2" stroke-linecap="round"/>
              <path d="M13 7l-5 5 5 5" stroke="#0369a1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          Volver al sitio
        </a>
      </div>
    </form>

    
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  (function() {
    const btn = document.querySelector('.toggle-password');
    const input = document.getElementById('id_password');
    if (btn && input) {
      btn.addEventListener('click', function() {
        const isPass = input.getAttribute('type') === 'password';
        input.setAttribute('type', isPass ? 'text' : 'password');
        btn.setAttribute('aria-label', isPass ? 'Ocultar contraseña' : 'Mostrar contraseña');
      });
    }
  })();
  // Enfocar al primer campo si el navegador no lo hizo
  (function() {
    const u = document.getElementById('id_username');
    if (u && document.activeElement !== u) u.focus();
  })();
</script>
{% endblock %}
